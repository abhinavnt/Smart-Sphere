<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile</title>

    <!--===============================================================================================-->	
	<link rel="icon" type="image/png" href="images/icons/favicon.png"/>
    <!--===============================================================================================-->
        <link rel="stylesheet" type="text/css" href="/vendor/bootstrap/css/bootstrap.min.css">
    <!--===============================================================================================-->
        <link rel="stylesheet" type="text/css" href="/fonts/font-awesome-4.7.0/css/font-awesome.min.css">
    <!--===============================================================================================-->
        <link rel="stylesheet" type="text/css" href="/fonts/iconic/css/material-design-iconic-font.min.css">
    <!--===============================================================================================-->
        <link rel="stylesheet" type="text/css" href="/fonts/linearicons-v1.0.0/icon-font.min.css">
    <!--===============================================================================================-->
        <link rel="stylesheet" type="text/css" href="/vendor/animate/animate.css">
    <!--===============================================================================================-->	
        <link rel="stylesheet" type="text/css" href="/vendor/css-hamburgers/hamburgers.min.css">
    <!--===============================================================================================-->
        <link rel="stylesheet" type="text/css" href="/vendor/animsition/css/animsition.min.css">
    <!--===============================================================================================-->
        <link rel="stylesheet" type="text/css" href="/vendor/select2/select2.min.css">
    <!--===============================================================================================-->	
        <link rel="stylesheet" type="text/css" href="/vendor/daterangepicker/daterangepicker.css">
    <!--===============================================================================================-->
        <link rel="stylesheet" type="text/css" href="/vendor/slick/slick.css">
    <!--===============================================================================================-->
        <link rel="stylesheet" type="text/css" href="/vendor/MagnificPopup/magnific-popup.css">
    <!--===============================================================================================-->
        <link rel="stylesheet" type="text/css" href="/vendor/perfect-scrollbar/perfect-scrollbar.css">
    <!--===============================================================================================-->
        <link rel="stylesheet" type="text/css" href="/css/util.css">
        <link rel="stylesheet" type="text/css" href="/css/main.css">



    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="/css/profile.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
    <!-- Include SweetAlert2 CSS and JS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>


    

</head>
<body>


    
    	<!--Header-->
	
	<%- include('partials/_header')%>

    <div class="container-fluid mt-5 ">
        <div class="row ">
            <div class="col-md-3 sidebar_profile">
                <div class="text-center mb-4">
                    <img src="<%= user.profilePicture || '/images/userP.jpg' %>" alt="Profile Image" class="profile-image">
                    <h4><%= user.username %></h4>
                </div>
                <div class="list_profile d-flex align-items-center justify-content-center">
                    <div class="list-group">
                        <a class="list-group-item list-group-item-action section-toggle" href="#" data-target="#details">
                            <i class="fas fa-user"></i> My Details
                        </a>
                        <a class="list-group-item list-group-item-action section-toggle" href="#" data-target="#addresses">
                            <i class="fas fa-map-marker-alt"></i> Addresses
                        </a>
                        <a class="list-group-item list-group-item-action section-toggle" href="#" data-target="#orders">
                            <i class="fas fa-box"></i> Orders
                        </a>
                        <a class="list-group-item list-group-item-action section-toggle" href="#" data-target="#wishlist">
                            <i class="fas fa-heart"></i> Wishlist
                        </a>
                    </div>
            </div>
            </div>


            <div class="col-md-9 content">
                <div id="details" class="section hidden">
                    <h2>My Details</h2>
                    <form id="profileForm">
                        <div class="form-group">
                            <label for="username">Username</label>
                            <input type="text" class="form-control" id="username" value="<%= user.username %>" required>
                        </div>
                        <div class="form-group">
                            <label for="email">Email</label>
                            <input type="email" class="form-control" id="email" value="<%= user.email %>" readonly>
                        </div>
                        <button type="submit" class="btn btn-primary">Update Profile</button>
                        <button type="button" class="btn btn-secondary" id="resetPasswordBtn">change Password</button>
                    </form>
                </div>
                
                <!-- Reset Password Modal -->
                <div class="modal" id="resetPasswordModal" tabindex="-1" role="dialog">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Reset Password</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <form id="resetPasswordForm">
                                    <div class="form-group">
                                        <label for="currentEmail">Current Email</label>
                                        <input type="email" class="form-control" id="currentEmail" value="<%= user.email %>" readonly>
                                    </div>
                                    <div class="form-group">
                                        <label for="currentPassword">Current Password</label>
                                        <div class="input-group">
                                            <input type="password" class="form-control" id="currentPassword">
                                            <button type="button" class="btn btn-outline-secondary" id="toggleCurrentPassword">
                                                <i class="bi bi-eye-slash" id="currentPasswordIcon"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <div class="form-group" id="currentPasswordNote" style="display: none;">
                                        <small class="form-text text-muted">This field is auto-filled if you have a Google account.</small>
                                    </div>
                                    <div class="form-group">
                                        <label for="newPassword">New Password</label>
                                        <div class="input-group">
                                            <input type="password" class="form-control" id="newPassword" required>
                                            <button type="button" class="btn btn-outline-secondary" id="toggleNewPassword">
                                                <i class="bi bi-eye-slash" id="newPasswordIcon"></i>
                                            </button>
                                        </div>
                                    </div>
                                
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                <button type="button" class="btn btn-primary" id="submitResetPassword">Submit</button>
                            </div>
                        </div>
                    </div>
                </div>
                

                


                
                

                <div id="addresses" class="section hidden">
                    <h2>Addresses</h2>
                    <ul class="list-group" id="addressList">
                        <% if (addresses.length > 0) { %>
                            <% addresses.forEach(address => { %>
                                <li class="list-group-item address-item">
                                    <div class="address-info">
                                        <strong><%= address.fullName %></strong><br>
                                        <%= address.address %>, <%= address.city %>, <%= address.pincode %><br>
                                    </div>
                                    <div class="address-actions">
                                        <button id="editAddressModal" class="btn btn-warning btn-sm editAddress" data-id="<%= address._id %>" data-fullname="<%= address.fullName %>" data-phone="<%= address.phone %>" data-address="<%= address.address %>" data-district="<%= address.district %>" data-city="<%= address.city %>" data-state="<%= address.state %>" data-pincode="<%= address.pincode %>" data-country="<%= address.country %>" data-type="<%= address.type %>">Edit</button>
                                        <button class="btn btn-danger btn-sm deleteAddress" data-id="<%= address._id %>">Delete</button>
                                    </div>
                                </li>
                            <% }) %>
                        <% } else { %>
                            <li class="list-group-item">No addresses found.</li>
                        <% } %>
                    </ul>
                
                    <br>
                    <!-- Button to Open Modal for Adding Address -->
                    <button type="button" id="openAddressModal" class="btn btn-primary" data-toggle="modal" data-target="#addressModal">
                        Add Address
                    </button>
                    
                    <!-- Modal for Adding/Editing Address -->
                    <div class="modal fade" id="addressModal" tabindex="-1" role="dialog" aria-labelledby="addressModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="addressModalLabel">Add New Address</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                        <span aria-hidden="true">&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <form id="addressForm">
                                        <input type="hidden" id="addressId"> <!-- Hidden input to store address ID for editing -->
                                        <div class="form-row">
                                            <div class="form-group col-md-6">
                                                <label for="fullName">Full Name</label>
                                                <input type="text" class="form-control" id="fullName" required>
                                                <span class="text-danger" id="fullNameError"></span>
                                            </div>
                                            <div class="form-group col-md-6">
                                                <label for="phone">Phone</label>
                                                <input type="tel" class="form-control" id="phone" required pattern="[0-9]{10}">
                                                <span class="text-danger" id="phoneError"></span>
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group col-md-6">
                                                <label for="address">Address</label>
                                                <input type="text" class="form-control" id="address" required>
                                                <span class="text-danger" id="addressError"></span>
                                            </div>
                                            <div class="form-group col-md-6">
                                                <label for="district">District</label>
                                                <input type="text" class="form-control" id="district" required>
                                                <span class="text-danger" id="districtError"></span>
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group col-md-6">
                                                <label for="city">City</label>
                                                <input type="text" class="form-control" id="city" required>
                                                <span class="text-danger" id="cityError"></span>
                                            </div>
                                            <div class="form-group col-md-6">
                                                <label for="state">State</label>
                                                <input type="text" class="form-control" id="state" required>
                                                <span class="text-danger" id="stateError"></span>
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group col-md-6">
                                                <label for="pincode">Pincode</label>
                                                <input type="text" class="form-control" id="pincode" required pattern="[0-9]{6}">
                                                <span class="text-danger" id="pincodeError"></span>
                                            </div>
                                            <div class="form-group col-md-6">
                                                <label for="country">Country</label>
                                                <input type="text" class="form-control" id="country" required>
                                                <span class="text-danger" id="countryError"></span>
                                            </div>
                                        </div>
                                        <div class="form-row">
                                            <div class="form-group col-md-6">
                                                <label for="addressType">Address Type</label>
                                                <select class="form-control" id="addressType" required>
                                                    <option value="" disabled selected>Select type</option>
                                                    <option value="work">Work</option>
                                                    <option value="home">Home</option>
                                                    <option value="other">Other</option>
                                                </select>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                    <button type="button" class="btn btn-primary" id="submitAddress">Add Address</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                </div>

                


                <div id="orders" class="section hidden">
                    <h2>Orders</h2>
                    
                    <% if (orders.length > 0) { %>
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Order Date</th>
                                <th>Products</th>
                                <th>Total Amount</th>
                                <th>Status</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <% orders.forEach(order => { %>
                            <tr>
                                <td><%= new Date(order.orderDate).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }) %></td>

                                <td>
                                    <div class="product-list">
                                        <% order.items.forEach(item => { %>
                                        <div class="product-info">
                                            <img src="/<%= item.productID.images[0] %>" alt="<%= item.productID.name %>" class="product-image">
                                            <span> x <%= item.quantity %></span>
                                        </div>
                                        <% }) %>
                                    </div>
                                </td>
                                <td>₹<%= order.totalAmount %></td>
                                <td><%= order.orderStatus %></td>
                                <td>
                                    <button class="btn btn-info btn-sm viewOrder" data-id="<%= order._id %>">View</button>
                                    <% if (order.orderStatus !== 'Delivered' && order.orderStatus !== 'Cancelled') { %>
                                        <button class="btn btn-danger btn-sm cancelOrder" data-id="<%= order._id %>">Cancel Order</button>
                                    <% } else if (order.orderStatus === 'Delivered') { %>
                                        <button class="btn btn-danger btn-sm" data-id="<%= order._id %>">Return Order</button>
                                    <% } %>
                                    
                                </td>
                            </tr>
                            <% }) %>
                        </tbody>
                    </table>
                    <% } else { %>
                    <div class="alert alert-info">No orders found.</div>
                    <% } %>


                    <!-- Cancellation Reason Modal -->
                    <div class="modal fade" id="cancelOrderModal" tabindex="-1" aria-labelledby="cancelOrderModalLabel" aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="cancelOrderModalLabel">Cancel Order</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <textarea id="cancellationReason" rows="4" class="form-control" placeholder="Enter reason for cancellation"></textarea>
                                    <div id="error-message" class="text-danger mt-2" style="display:none;"></div>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    <button type="button" class="btn btn-danger" id="confirmCancelBtn">Submit Cancellation</button>
                                </div>
                            </div>
                        </div>
                    </div>



                    <!-- to show order details -->
                    <div class="modal fade" id="orderDetailModal" tabindex="-1" aria-labelledby="orderDetailModalLabel" aria-hidden="true">
                        <div class="modal-dialog custom-modal">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="orderDetailModalLabel">Order Details</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <h5>Ordered Date: <span id="orderedDate"></span></h5>
                                    <h5>Order Time: <span id="orderTime"></span></h5>
                                    <h5>Status: <span id="orderStatus"></span></h5>
                                    
                                    <h5>Shipping Address:</h5>
                                    <p id="shippingAddress"></p>
                    
                                    <h5>Ordered Products:</h5>
                                    <div id="orderedProducts" class="row"></div>
                                    
                                    <h5>Total Amount: <span id="totalAmount"></span></h5>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    


                </div>
                
                

                <div id="wishlist" class="section hidden">
                    <h2>Wishlist</h2>
                    <p>No items in your wishlist.</p>
                    <!-- Wishlist items would be populated here -->
                </div>
            </div>
        </div>
    </div>


    <!-- footer -->

    <%- include('partials/_footer')%>

<!--===============================================================================================-->	
<script src="/vendor/jquery/jquery-3.2.1.min.js"></script>
<!--===============================================================================================-->
	<script src="/vendor/animsition/js/animsition.min.js"></script>
<!--===============================================================================================-->
	<script src="/vendor/bootstrap/js/popper.js"></script>
	<script src="/vendor/bootstrap/js/bootstrap.min.js"></script>
<!--===============================================================================================-->
	<script src="/vendor/select2/select2.min.js"></script>
	<script>
		$(".js-select2").each(function(){
			$(this).select2({
				minimumResultsForSearch: 20,
				dropdownParent: $(this).next('.dropDownSelect2')
			});
		})
	</script>
<!--===============================================================================================-->
	<script src="/vendor/daterangepicker/moment.min.js"></script>
	<script src="/vendor/daterangepicker/daterangepicker.js"></script>
<!--===============================================================================================-->
	<script src="/vendor/slick/slick.min.js"></script>
	<script src="/javascripts/slick-custom.js"></script>
<!--===============================================================================================-->
	<script src="/vendor/parallax100/parallax100.js"></script>
	<script>
        $('.parallax100').parallax100();
	</script>
<!--===============================================================================================-->
	<script src="/vendor/MagnificPopup/jquery.magnific-popup.min.js"></script>
	<script>
		$('.gallery-lb').each(function() { // the containers for all your galleries
			$(this).magnificPopup({
		        delegate: 'a', // the selector for gallery item
		        type: 'image',
		        gallery: {
		        	enabled:true
		        },
		        mainClass: 'mfp-fade'
		    });
		});
	</script>
<!--===============================================================================================-->
	<script src="/vendor/isotope/isotope.pkgd.min.js"></script>
<!--===============================================================================================-->
	<script src="/vendor/sweetalert/sweetalert.min.js"></script>
	<script>
		$('.js-addwish-b2').on('click', function(e){
			e.preventDefault();
		});

		$('.js-addwish-b2').each(function(){
			var nameProduct = $(this).parent().parent().find('.js-name-b2').html();
			$(this).on('click', function(){
				swal(nameProduct, "is added to wishlist !", "success");

				$(this).addClass('js-addedwish-b2');
				$(this).off('click');
			});
		});

		$('.js-addwish-detail').each(function(){
			var nameProduct = $(this).parent().parent().parent().find('.js-name-detail').html();

			$(this).on('click', function(){
				swal(nameProduct, "is added to wishlist !", "success");

				$(this).addClass('js-addedwish-detail');
				$(this).off('click');
			});
		});

	

		$('.js-addcart-detail').each(function(){
			var nameProduct = $(this).parent().parent().parent().parent().find('.js-name-detail').html();
			$(this).on('click', function(){
				swal(nameProduct, "is added to cart !", "success");
			});
		});
	
	</script>
<!--===============================================================================================-->
	<script src="/vendor/perfect-scrollbar/perfect-scrollbar.min.js"></script>
	<script>
		$('.js-pscroll').each(function(){
			$(this).css('position','relative');
			$(this).css('overflow','hidden');
			var ps = new PerfectScrollbar(this, {
				wheelSpeed: 1,
				scrollingThreshold: 1000,
				wheelPropagation: false,
			});

			$(window).on('resize', function(){
				ps.update();
			})
		});
	</script>


<script src="/javascripts/main.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>


<script>

$(document).ready(function() {

    let lastSection = localStorage.getItem('lastSection') || '#details';
    showSection(lastSection);

    
    $('.section-toggle').on('click', function(e) {
        e.preventDefault();
        
        let targetSection = $(this).data('target');
        
        
        showSection(targetSection);
        localStorage.setItem('lastSection', targetSection);
    });

   
    function showSection(sectionId) {
        $('.section').addClass('hidden'); 
        $(sectionId).removeClass('hidden'); 
        
       
        if (sectionId === '#details') {
            populateDetails();
        } else if (sectionId === '#addresses') {
            populateAddresses();
        } else if (sectionId === '#orders') {
            populateOrders();
        } else if (sectionId === '#wishlist') {
            populateWishlist();
        }
    }

    
    function populateDetails() {
        $('#username').val('<%=user.username%>');
        $('#email').val('<%=user.email%>');
    }

  
    function populateAddresses() {
      
    }

   
    function populateOrders() {
       
    }

   
    function populateWishlist() {
       
    }
}); 
        
</script>


<!-- oder -->

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script src="/javascripts/profile.js"> </script>
</body>
</html>
<script>
  window.userId = '<%= user._id %>';

</script>